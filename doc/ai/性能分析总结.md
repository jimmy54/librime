# Octagram vs ContextualRankingFilter æ€§èƒ½åˆ†ææ€»ç»“

## ğŸ¯ æ ¸å¿ƒé—®é¢˜

**ä¸ºä»€ä¹ˆ Octagram å¿«ï¼Œè€Œ ContextualRankingFilter æ…¢ï¼Ÿ**

---

## ğŸ“Š ä¸€å¥è¯æ€»ç»“

**Octagram åœ¨æ„å»ºå¥å­æ—¶å°±å®Œæˆè¯„åˆ†ï¼Œè€Œ ContextualRankingFilter åœ¨å€™é€‰ç”Ÿæˆåæ‰é‡æ’ã€‚**

å°±åƒï¼š
- ğŸ­ **Octagram**: å·¥å‚æµæ°´çº¿ä¸Šç›´æ¥è´¨æ£€ï¼ˆè¾¹ç”Ÿäº§è¾¹æ£€æŸ¥ï¼‰
- ğŸ“¦ **ContextualRankingFilter**: äº§å“ç”Ÿäº§å®Œå†ç»Ÿä¸€è´¨æ£€ï¼ˆç”Ÿäº§å®Œå†æ£€æŸ¥ï¼‰

---

## ğŸ” è¯¦ç»†å¯¹æ¯”

### Octagram (Poet) çš„è°ƒç”¨é“¾

```
ç”¨æˆ·è¾“å…¥ "nihao"
    â†“
TableTranslator::Query()
    â†“
Poet::MakeSentence()  â† æ„å»ºå¥å­
    â†“
    for æ¯ä¸ªä½ç½®:
        for æ¯ä¸ªå€™é€‰è¯:
            âœ… Grammar::Evaluate()  â† ç«‹å³è¯„åˆ†
            âœ… åªä¿ç•™æœ€ä¼˜çš„7ä¸ªå€™é€‰
            âœ… ç´¯åŠ æƒé‡ï¼šæ–°æƒé‡ = å‰é©±æƒé‡ + å½“å‰è¯„åˆ†
    â†“
è¿”å›æœ€ä¼˜å¥å­ï¼ˆå·²æ’åºï¼Œæ— éœ€é‡æ’ï¼‰
```

**å…³é”®ç‚¹**:
1. âœ… **è¾¹æ„å»ºè¾¹è¯„åˆ†** - è¯„åˆ†é›†æˆåœ¨æ„å»ºè¿‡ç¨‹ä¸­
2. âœ… **åŠ¨æ€å‰ªæ** - æ¯ä¸ªä½ç½®åªä¿ç•™ Top 7
3. âœ… **å¢é‡è®¡ç®—** - ç´¯åŠ æƒé‡ï¼Œä¸é‡å¤è®¡ç®—
4. âœ… **æ— éœ€æ’åº** - ç»“æœå¤©ç„¶æœ‰åº

**æ—¶é—´**: ~2-5ms (åŒ…å«æ„å»ºå’Œè¯„åˆ†)

---

### ContextualRankingFilter çš„è°ƒç”¨é“¾

```
ç”¨æˆ·è¾“å…¥ "nihao"
    â†“
TableTranslator::Query()
    â†“
ç”Ÿæˆå€™é€‰åˆ—è¡¨ (8ä¸ªå€™é€‰)
    â†“
ContextualRankingFilter::Apply()  â† åå¤„ç†
    â†“
    for æ¯ä¸ªå€™é€‰ (8ä¸ª):
        âŒ å·¦ä¸Šä¸‹æ–‡è¯„åˆ†: grammar_->Query()
        âŒ å³ä¸Šä¸‹æ–‡è¯„åˆ†: grammar_->Query()
        âŒ æ€»è¯„åˆ† = åŸå§‹æƒé‡ + å·¦è¯„åˆ† + å³è¯„åˆ†
    â†“
    âŒ std::stable_sort() æ’åºæ‰€æœ‰å€™é€‰
    â†“
è¿”å›é‡æ’åçš„å€™é€‰åˆ—è¡¨
```

**å…³é”®ç‚¹**:
1. âŒ **åå¤„ç†é‡æ’** - å€™é€‰ç”Ÿæˆåæ‰è¯„åˆ†
2. âŒ **å…¨é‡è¯„åˆ†** - å¯¹æ‰€æœ‰å€™é€‰éƒ½è¯„åˆ†ï¼ˆ8ä¸ª Ã— 2æ¬¡ = 16æ¬¡æŸ¥è¯¢ï¼‰
3. âŒ **é‡å¤è®¡ç®—** - æ¯æ¬¡è¾“å…¥éƒ½é‡æ–°è¯„åˆ†
4. âŒ **é¢å¤–æ’åº** - éœ€è¦ O(n log n) æ’åº

**æ—¶é—´**: ~10-15ms (é¢å¤–å¼€é”€)

---

## ğŸ“ˆ æ€§èƒ½æ•°æ®å¯¹æ¯”

| æŒ‡æ ‡ | Octagram | ContextualRankingFilter | å·®å¼‚ |
|------|----------|------------------------|------|
| **è¯„åˆ†æ—¶æœº** | æ„å»ºæ—¶ | åå¤„ç† | - |
| **è¯„åˆ†æ¬¡æ•°** | æŒ‰éœ€ï¼ˆå‰ªæåï¼‰ | å…¨é‡ï¼ˆ8-20ä¸ªï¼‰ | 2-4å€ |
| **æ’åºå¼€é”€** | æ— ï¼ˆå¤©ç„¶æœ‰åºï¼‰ | O(n log n) | - |
| **æ€»å»¶è¿Ÿ** | 2-5ms | 10-15ms | **3å€** |
| **ç”¨æˆ·æ„ŸçŸ¥** | æµç•… | å¡é¡¿ | - |

---

## ğŸ¨ å½¢è±¡æ¯”å–»

### Octagram (é«˜æ•ˆ)
```
ğŸ­ æ±½è½¦ç”Ÿäº§çº¿:
   [é›¶ä»¶] â†’ [ç»„è£…+è´¨æ£€] â†’ [æˆå“]
           â†‘ è¾¹ç»„è£…è¾¹æ£€æŸ¥
   
   - ä¸åˆæ ¼é›¶ä»¶ç«‹å³ä¸¢å¼ƒ
   - åªä¿ç•™æœ€ä¼˜çš„7ä¸ªæ–¹æ¡ˆ
   - æœ€ç»ˆäº§å“å·²ç»æ˜¯æœ€ä¼˜çš„
```

### ContextualRankingFilter (ä½æ•ˆ)
```
ğŸ“¦ ä¼ ç»Ÿå·¥å‚:
   [é›¶ä»¶] â†’ [ç»„è£…] â†’ [å…¨éƒ¨è´¨æ£€] â†’ [æ’åº] â†’ [æˆå“]
                    â†‘ ç”Ÿäº§å®Œå†æ£€æŸ¥
   
   - æ‰€æœ‰äº§å“éƒ½è¦æ£€æŸ¥
   - æ£€æŸ¥å®Œå†æ’åº
   - é¢å¤–çš„å¤„ç†æ­¥éª¤
```

---

## ğŸ’¡ ä¸ºä»€ä¹ˆå·®è·è¿™ä¹ˆå¤§ï¼Ÿ

### 1. æ¶æ„å·®å¼‚ï¼ˆæ ¹æœ¬åŸå› ï¼‰

**Octagram**: 
```cpp
// åœ¨ Poet::MakeSentence() ä¸­
for (æ¯ä¸ªä½ç½®) {
  for (æ¯ä¸ªå€™é€‰) {
    double weight = candidate.weight + 
                    Grammar::Evaluate(...);  // â† ç«‹å³è¯„åˆ†
    if (weight > best.weight) {
      best = new_candidate;  // â† åªä¿ç•™æœ€ä¼˜
    }
  }
}
```

**ContextualRankingFilter**:
```cpp
// åœ¨ Filter::Apply() ä¸­
for (æ¯ä¸ªå€™é€‰) {
  score = grammar_->Query(...);  // â† åå¤„ç†è¯„åˆ†
  scored_candidates.push_back({cand, score});
}
std::stable_sort(scored_candidates);  // â† é¢å¤–æ’åº
```

### 2. ç®—æ³•å·®å¼‚

| ç‰¹æ€§ | Octagram | ContextualRankingFilter |
|------|----------|------------------------|
| ç®—æ³• | åŠ¨æ€è§„åˆ’ + æŸæœç´¢ | æš´åŠ›æšä¸¾ + æ’åº |
| å‰ªæ | âœ… æ¯ä¸ªä½ç½®åªä¿ç•™ Top 7 | âŒ è¯„ä¼°æ‰€æœ‰å€™é€‰ |
| ç¼“å­˜ | âœ… å¢é‡è®¡ç®—æƒé‡ | âŒ æ¯æ¬¡é‡æ–°è®¡ç®— |
| æ’åº | âœ… æ— éœ€æ’åº | âŒ O(n log n) |

### 3. è§¦å‘æ—¶æœº

**Octagram**: 
- ä¸»åŠ¨åœ¨æ„å»ºæ—¶è°ƒç”¨
- åªåœ¨éœ€è¦æ—¶è®¡ç®—
- ä¸æ„å»ºè¿‡ç¨‹èåˆ

**ContextualRankingFilter**:
- è¢«åŠ¨å“åº”æ¯æ¬¡å€™é€‰ç”Ÿæˆ
- ä½œä¸º Filter å¿…é¡»å¤„ç†æ‰€æœ‰å€™é€‰
- ç‹¬ç«‹çš„å¤„ç†å±‚

---

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### æ¨èæ–¹æ¡ˆ: å°†è¯„åˆ†é›†æˆåˆ° Translator

**æ ¸å¿ƒæ€æƒ³**: å­¦ä¹  Octagramï¼Œåœ¨ç”Ÿæˆå€™é€‰æ—¶å°±è¯„åˆ†

```cpp
// æ–°çš„ ContextualTableTranslation
class ContextualTableTranslation : public TableTranslation {
  an<Candidate> Peek() override {
    auto candidate = TableTranslation::Peek();
    
    // åœ¨è¿”å›å€™é€‰æ—¶å°±è¯„åˆ†
    if (grammar_ && !context_.empty()) {
      double contextual_score = grammar_->Query(context_, 
                                                candidate->text(), 
                                                false);
      candidate->set_quality(candidate->quality() + contextual_score);
    }
    
    return candidate;
  }
};
```

**æ•ˆæœ**:
- âœ… æ— éœ€åå¤„ç† Filter
- âœ… æ— éœ€é¢å¤–æ’åº
- âœ… æ€§èƒ½æå‡ 60%+
- âœ… ä» 13ms â†’ 5ms

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### ç¬¬1æ­¥: åˆ›å»ºé›†æˆå¼ Translation
```cpp
// æ–°å»º contextual_table_translation.h/cc
// åœ¨ Peek() æ—¶å°±è¯„åˆ†
```

### ç¬¬2æ­¥: ä¿®æ”¹ TableTranslator
```cpp
// åœ¨ Query() ä¸­ä½¿ç”¨ ContextualTableTranslation
// ä¼ å…¥ä¸Šä¸‹æ–‡å’Œè¯­æ³•æ¨¡å‹
```

### ç¬¬3æ­¥: ç§»é™¤ Filter
```cpp
// åˆ é™¤ contextual_ranking_filter.h/cc
// æ›´æ–°é…ç½®æ–‡ä»¶
```

**é¢„è®¡æ—¶é—´**: 3-5å¤©

**æ€§èƒ½æå‡**: 60%+ (13ms â†’ 5ms)

---

## ğŸ¯ å…³é”®ç»“è®º

1. **Filter æ¨¡å¼å¤©ç”Ÿæ…¢** - åå¤„ç†æ¶æ„æ— æ³•ä¸æ„å»ºæ—¶è¯„åˆ†ç›¸æ¯”
2. **Octagram çš„å¿«æ˜¯æ¶æ„ä¼˜åŠ¿** - ä¸æ˜¯ç®—æ³•æŠ€å·§
3. **è¦è¾¾åˆ° Octagram çš„æ€§èƒ½** - å¿…é¡»æ”¾å¼ƒ Filterï¼Œé›†æˆåˆ° Translator

### ä¸€å¥è¯æ€»ç»“

**æƒ³è¦å¿«ï¼Œå°±è¦åœ¨æ„å»ºæ—¶è¯„åˆ†ï¼Œè€Œä¸æ˜¯ç”Ÿæˆåé‡æ’ï¼**

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- è¯¦ç»†åˆ†æ: `OCTAGRAM_VS_CONTEXTUAL_RANKING_ANALYSIS.md`
- å®ç°æ–¹æ¡ˆ: `CONTEXTUAL_INTEGRATION_SOLUTION.md`
- æ€§èƒ½æµ‹è¯•: `PERFORMANCE_TEST_GUIDE.md`
